import React, { useState, useEffect } from 'react'

// Crampons Direct Boutique
// Single-file React component using Tailwind CSS classes.
// Features:
// - Landing + product grid (football & rugby crampons, chaussettes antidérapantes)
// - Hidden admin login button (petit rond en bas à gauche)
// - Admin panel to add a product (title, sport, description, image upload, optional price)
// - No cart, no filters, only "Nous contacter" button linking to Instagram DM
// - Products persist in localStorage

export default function CramponsDirectApp() {
  const ADMIN_USER = 'admin'
  const ADMIN_PASS = 'herve regnier le goat' // password provided by owner

  const [products, setProducts] = useState([])
  const [showLogin, setShowLogin] = useState(false)
  const [showAdmin, setShowAdmin] = useState(false)
  const [loginUser, setLoginUser] = useState('')
  const [loginPass, setLoginPass] = useState('')
  const [alertMsg, setAlertMsg] = useState('')

  // Add-product form
  const [newTitle, setNewTitle] = useState('')
  const [newSport, setNewSport] = useState('Football')
  const [newDesc, setNewDesc] = useState('')
  const [newPrice, setNewPrice] = useState('')
  const [newImgData, setNewImgData] = useState(null)

  useEffect(() => {
    const saved = localStorage.getItem('crampons_direct_products')
    if (saved) setProducts(JSON.parse(saved))
  }, [])

  useEffect(() => {
    localStorage.setItem('crampons_direct_products', JSON.stringify(products))
  }, [products])

  function handleImageUpload(e) {
    const file = e.target.files?.[0]
    if (!file) return
    const reader = new FileReader()
    reader.onload = () => setNewImgData(reader.result)
    reader.readAsDataURL(file)
  }

  function addProduct(e) {
    e.preventDefault()
    if (!newTitle) return setAlertMsg('Donne un titre au crampon')
    const p = {
      id: Date.now(),
      title: newTitle,
      sport: newSport,
      description: newDesc,
      price: newPrice,
      img: newImgData,
    }
    setProducts([p, ...products])
    setNewTitle('')
    setNewDesc('')
    setNewPrice('')
    setNewImgData(null)
    setAlertMsg('Crampon ajouté ✓')
    setTimeout(() => setAlertMsg(''), 2000)
  }

  function removeProduct(id) {
    if (!confirm('Supprimer ce produit ?')) return
    setProducts(products.filter(p => p.id !== id))
  }

  function attemptLogin(e) {
    e.preventDefault()
    if (loginUser === ADMIN_USER && loginPass === ADMIN_PASS) {
      setShowAdmin(true)
      setShowLogin(false)
      setLoginPass('')
      setLoginUser('')
      setAlertMsg("Connecté en admin")
      setTimeout(() => setAlertMsg(''), 1500)
    } else {
      setAlertMsg('Mauvais identifiants')
    }
  }

  // Small helper component for product card
  function ProductCard({ p }) {
    return (
      <div className="bg-white rounded-2xl shadow-md p-4 flex flex-col">
        <div className="h-48 flex items-center justify-center overflow-hidden rounded-lg bg-gray-100">
          {p.img ? (
            <img src={p.img} alt={p.title} className="object-contain h-full" />
          ) : (
            <div className="text-gray-400">Aucune image</div>
          )}
        </div>
        <h3 className="mt-3 font-semibold">{p.title}</h3>
        <div className="text-sm text-gray-500">{p.sport}</div>
        <p className="mt-2 text-sm flex-1">{p.description}</p>
        {p.price ? <div className="mt-2 font-medium">{p.price} €</div> : null}
        <div className="mt-3 flex gap-2">
          <button className="flex-1 py-2 rounded-xl border border-gray-200 text-sm">Voir</button>
          {/* No add-to-cart by request */}
        </div>
      </div>
    )
  }

  return (
    <div className="min-h-screen bg-gradient-to-b from-sky-50 to-white text-gray-800">
      <header className="max-w-6xl mx-auto p-6 flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-extrabold tracking-tight">Crampons Direct Boutique</h1>
          <div className="text-xs text-gray-500">Crampons football & rugby — Chaussettes antidérapantes</div>
        </div>
        <div className="flex items-center gap-4">
          <a href="https://www.instagram.com/cramponsdirect/" target="_blank" rel="noreferrer" className="px-4 py-2 rounded-xl bg-black text-white text-sm">Nous contacter</a>
        </div>
      </header>

      <main className="max-w-6xl mx-auto p-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
        <section className="lg:col-span-2">
          <div className="bg-white rounded-2xl p-6 shadow-md">
            <h2 className="text-xl font-bold">Les crampons du moment</h2>
            <p className="text-sm text-gray-500 mt-2">Sportif, dynamique — découvre les crampons sélectionnés pour la saison.</p>

            <div className="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-4">
              {products.length === 0 ? (
                <div className="text-gray-400">Aucun produit pour l'instant. Connecte-toi en admin pour ajouter.</div>
              ) : (
                products.map(p => <ProductCard key={p.id} p={p} />)
              )}
            </div>
          </div>
        </section>

        <aside className="">
          <div className="bg-white rounded-2xl p-6 shadow-md sticky top-6">
            <h3 className="text-lg font-semibold">À propos</h3>
            <p className="mt-2 text-sm text-gray-600">Site simple et direct : pas de panier, pas de filtres. Tu veux un crampon ? Contacte-nous sur Instagram.</p>

            <div className="mt-4">
              <h4 className="text-sm font-medium">Catégories</h4>
              <div className="mt-2 text-sm text-gray-500">Football, Rugby, Accessoires (chaussettes antidérapantes)</div>
            </div>

            <div className="mt-4 text-xs text-gray-400">Version: prototype — connecté en admin = édition</div>
          </div>
        </aside>
      </main>

      {/* Admin area modal */}
      {showAdmin && (
        <div className="fixed inset-0 bg-black/40 flex items-center justify-center p-4">
          <div className="w-full max-w-2xl bg-white rounded-2xl p-6 shadow-xl">
            <div className="flex justify-between items-center">
              <h3 className="text-lg font-bold">Admin — Ajouter / Gérer les crampons</h3>
              <div className="flex items-center gap-2">
                <button onClick={() => { setShowAdmin(false) }} className="text-sm text-gray-500">Fermer</button>
                <button onClick={() => { setProducts([]); localStorage.removeItem('crampons_direct_products') }} className="text-sm text-red-500">Vider tout</button>
              </div>
            </div>

            <form onSubmit={addProduct} className="mt-4 flex flex-col gap-3">
              <input value={newTitle} onChange={e => setNewTitle(e.target.value)} placeholder="Titre" className="p-3 border rounded-lg" />
              <select value={newSport} onChange={e => setNewSport(e.target.value)} className="p-3 border rounded-lg">
                <option>Football</option>
                <option>Rugby</option>
                <option>Accessoire</option>
              </select>
              <textarea value={newDesc} onChange={e => setNewDesc(e.target.value)} placeholder="Description" className="p-3 border rounded-lg" />
              <input value={newPrice} onChange={e => setNewPrice(e.target.value)} placeholder="Prix (optionnel)" className="p-3 border rounded-lg" />

              <label className="py-2 px-3 border-dashed border rounded-lg text-sm text-gray-600 flex items-center gap-2">
                <input type="file" accept="image/*" onChange={handleImageUpload} />
                <span>Uploader une photo (optionnel)</span>
              </label>

              {newImgData && (
                <div className="border rounded-lg p-2">
                  <img src={newImgData} alt="preview" className="h-40 object-contain mx-auto" />
                </div>
              )}

              <div className="flex gap-2">
                <button className="bg-black text-white px-4 py-2 rounded-xl">Ajouter</button>
                <button type="button" onClick={() => { setNewTitle(''); setNewDesc(''); setNewImgData(null); setNewPrice('') }} className="px-4 py-2 rounded-xl border">Réinitialiser</button>
              </div>
            </form>

            <div className="mt-6">
              <h4 className="font-medium">Produits</h4>
              <div className="mt-3 grid grid-cols-1 gap-2 max-h-60 overflow-auto">
                {products.map(p => (
                  <div key={p.id} className="flex items-center gap-3 p-2 border rounded-lg">
                    <div className="w-16 h-16 bg-gray-100 flex items-center justify-center rounded-md overflow-hidden">
                      {p.img ? <img src={p.img} alt="mini" className="object-contain h-full" /> : <div className="text-xs text-gray-400">no img</div>}
                    </div>
                    <div className="flex-1">
                      <div className="font-medium">{p.title}</div>
                      <div className="text-xs text-gray-500">{p.sport} {p.price ? `· ${p.price}€` : ''}</div>
                    </div>
                    <button onClick={() => removeProduct(p.id)} className="text-sm text-red-500">Suppr</button>
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Login modal */}
      {showLogin && (
        <div className="fixed inset-0 bg-black/40 flex items-center justify-center p-4">
          <div className="w-full max-w-md bg-white rounded-2xl p-6 shadow-xl">
            <h3 className="text-lg font-bold">Connexion Admin</h3>
            <form onSubmit={attemptLogin} className="mt-4 flex flex-col gap-3">
              <input value={loginUser} onChange={e => setLoginUser(e.target.value)} placeholder="Identifiant" className="p-3 border rounded-lg" />
              <input value={loginPass} onChange={e => setLoginPass(e.target.value)} type="password" placeholder="Mot de passe" className="p-3 border rounded-lg" />
              <div className="flex gap-2">
                <button className="bg-black text-white px-4 py-2 rounded-xl">Se connecter</button>
                <button type="button" onClick={() => setShowLogin(false)} className="px-4 py-2 rounded-xl border">Annuler</button>
              </div>
            </form>
          </div>
        </div>
      )}

      {/* Small hidden admin trigger (petit rond un peu caché en bas à gauche) */}
      <button
        title="Accès admin"
        onClick={() => setShowLogin(true)}
        className="fixed left-4 bottom-4 w-10 h-10 rounded-full bg-black/10 text-black/20 flex items-center justify-center text-xs shadow-md hover:opacity-100"
        style={{ opacity: 0.3 }}
      >
        •
      </button>

      {/* Simple floating alert */}
      {alertMsg && (
        <div className="fixed right-4 bottom-20 bg-black text-white px-4 py-2 rounded-xl shadow-lg">{alertMsg}</div>
      )}

      <footer className="mt-12 py-8 text-center text-xs text-gray-400">© Crampons Direct Boutique — prototype</footer>
    </div>
  )
}
